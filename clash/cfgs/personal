---
# ==============================================================================
#
# V2rayN/NG:  https://d.cloudso.club/link/C4OZwUTBHQCvvu2Y?sub=3&extend=1
# Clash:  https://d.cloudso.club/link/C4OZwUTBHQCvvu2Y?clash=1
#
# ------------------------------------------------------------------------------
# 🇲🇴 🇨🇳

redir-port: 51366
# 混合代理端口
mixed-port: 51300
# Socks5 代理端口
socks-port: 51301
# HTTP 代理端口
port: 51302
# RESTful API for clash
external-controller: "127.0.0.1:51377"
# 规则模式: rule (规则) / global (全局代理) / direct (全局直连)
mode: rule
# 设置日志输出级别 (默认级别：silent，即不输出任何内容，以避免因日志内容过大而导致程序内存溢出）。
# 5 个级别: silent / info / warning / error / debug。级别越高日志输出量越大，越倾向于调试，若需要请自行开启。
log-level: error
# RESTful API secret
secret: "p0o9i8u7"
# 允许局域网的连接（可用来共享代理）
allow-lan: true

# # ==> 此功能仅在 allow-lan 设置为 true 时生效，支持三种参数：
# # ==> "*"                           绑定所有的 IP 地址
# # ==> 192.168.122.11                绑定一个 IPv4 地址
# # ==> "[aaaa::a8aa:ff:fe09:57d8]"   绑定一个 IPv6 地址
# bind-address: "*"
# bind-address: "172.28.12.169"

# 本地 SOCKS5 / HTTP(S) 服务认证
# authentication:
#   - "myUsername:myPassword"

# ------------------------------------------------------------------------------
# 您可以将静态网页资源（如 clash-dashboard）放置在一个目录中，clash 将会服务于 `${API}/ui`
# 参数应填写配置目录的相对路径或绝对路径。
# external-ui: folder

# # 实验性功能 hosts, 支持通配符 (例如 *.clash.dev 甚至 *.foo.*.example.com)
# # 静态的域名 比 通配域名 具有更高的优先级 (foo.example.com 优先于 *.example.com)
# # 注意: hosts 在 fake-ip 模式下不生效
hosts:
  "*.chenzhenyuan.cn": 127.0.0.1
  "*.chenzhenyuan.io": 127.0.0.1
  "chenzhenyuan.cn": 127.0.0.1
  "chenzhenyuan.io": 127.0.0.1

dns:
  # 是否启用dns
  enable: true
  ipv6: true
  use-hosts: true
  listen: 127.0.0.1:53
  # 模式: redir-host 或 fake-ip
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  # #列表中的域名将不会被解析为fake ip，这些域名相关的解析请求将会返回它们真实的IP地址
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "*.chenzhenyuan.com"
    - "*.battlenet.com.cn"
    - "*.battlenet.com"
    - "*.blzstatic.cn"
    - "*.battle.net"
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.xboxlive.com"
    - "*.ip.sb"
    - "*.jsdelivr.net"
    - "ip.sb"
    - "localhost.ptlogin2.qq.com"
    - "msftconnecttest.com"
    - "xbox.*.microsoft.com"
    - "jsdelivr.net"
    - "raw.gitmirror.com"
    - "chenzhenyuan.com"

  nameserver-policy:
    # 私人域名
    "*.chenzhenyuan.com": 119.29.29.29
  # default-nameserver:
  #   - 119.29.29.29
  #   - 223.5.5.5
  nameserver:
    - 119.29.29.29
    - 223.5.5.5
    # 阿里云 DoH DNS
    - "https://dns.alidns.com/dns-query"
  fallback:
    # Cloudflare DNS
    - 1.1.1.1
    - tls://1.0.0.1:853
    - https://doh.pub/dns-query
    - https://dns.cloudflare.com/dns-query

    # Google
    - 8.8.8.8
    - tls://8.8.4.4:853
    - tls://dns.google:853
    - https://dns.google/dns-query

    - 45.11.45.11
    - https://45.11.45.11/dns-query
    - 185.222.222.222
    - https://185.222.222.222/dns-query
    - https://doh.sb/dns-query
    # - https://doh.dns.sb/dns-query
  fallback-filter:
    geoip: true
    ipcidr:
      - 240.0.0.0/4
      - 127.0.0.1/32
      - 0.0.0.0/32

proxy-providers:
  香港机房:
    type: http
    path: ./proxies/HongKong.yaml
    url: https://chenzhenyuan.com/clash/proxies/HongKong.yaml
    filter: 香港
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

  台湾机房:
    type: http
    path: ./proxies/Taiwan.yaml
    url: https://chenzhenyuan.com/clash/proxies/Taiwan.yaml
    filter: 台湾
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

  新加坡机房:
    type: http
    path: ./proxies/Singapore.yaml
    url: https://chenzhenyuan.com/clash/proxies/Singapore.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

  日本机房:
    type: http
    path: ./proxies/Japan.yaml
    url: https://chenzhenyuan.com/clash/proxies/Japan.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

  韩国机房:
    type: http
    path: ./proxies/Korea.yaml
    url: https://chenzhenyuan.com/clash/proxies/Korea.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

  美国机房:
    type: http
    path: ./proxies/America.yaml
    url: https://chenzhenyuan.com/clash/proxies/America.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

  其他机房:
    type: http
    path: ./proxies/GlobalArea.yaml
    url: https://chenzhenyuan.com/clash/proxies/GlobalArea.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

# <classical | domain>
rule-providers:
  AdBlock:
    type: http
    behavior: classical
    # url: https://raw.iqiq.io/Semporia/Clash/master/Rule/AdBlock.yaml
    url: https://raw.iqiq.io/JAYNE0110/clashx/release/providers/ruleset/apple.yaml
    path: ./ruleset/JAYNE0110/clashx/AdBlock.yaml
    interval: 3600
  Apple:
    type: http
    behavior: classical
    url: https://raw.iqiq.io/JAYNE0110/clashx/release/providers/ruleset/apple.yaml
    path: ./ruleset/JAYNE0110/clashx/apple.yaml
    interval: 3600
  Applications:
    type: http
    behavior: classical
    url: https://chenzhenyuan.com/clash/rules/applications.yaml
    path: ./ruleset/chenzhenyuan/applications.yaml
    interval: 3600
  ChinaDomain:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Providers/ChinaDomain.yaml
    path: ./ruleset/ACL4SSR/ACL4SSR/ChinaDomain.yaml
    interval: 3600
  GitHub:
    type: http
    behavior: classical
    url: https://chenzhenyuan.com/clash/rules/github.yaml
    path: ./ruleset/chenzhenyuan/github.yaml
    interval: 3600
  Google:
    type: http
    behavior: classical
    url: https://raw.iqiq.io/Semporia/Clash/master/Rule/Google.yaml
    path: ./ruleset/chenzhenyuan/google.yaml
    interval: 3600
  LocalAreaNetwork:
    type: http
    behavior: classical
    url: https://chenzhenyuan.com/clash/rules/lan.yaml
    path: ./ruleset/chenzhenyuan/lan.yaml
    interval: 86400
  GFW:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt
    path: ./ruleset/Loyalsoldier/clash-rules/ProxyGFWlist.yaml
    interval: 3600
  OverseasIP:
    type: http
    behavior: classical
    url: https://raw.iqiq.io/JAYNE0110/clashx/release/providers/ruleset/overseas-ip
    path: ./ruleset/JAYNE0110/clashx/overseas-ip.yaml
    format: yaml
    interval: 3600
  Telegram:
    type: http
    behavior: classical
    url: https://raw.iqiq.io/JAYNE0110/clashx/release/providers/ruleset/telegram
    path: ./ruleset/JAYNE0110/clashx/telegram.yaml
    format: yaml
    interval: 3600
  Tencent:
    type: http
    behavior: classical
    url: https://chenzhenyuan.com/clash/rules/tencent.yaml
    path: ./ruleset/chenzhenyuan/tencent.yaml
    interval: 3600
  Twitter:
    type: http
    behavior: classical
    url: https://chenzhenyuan.com/clash/rules/twitter.yaml
    path: ./ruleset/chenzhenyuan/twitter.yaml
    interval: 3600
  YouTube:
    type: http
    behavior: classical
    url: https://raw.iqiq.io/Semporia/Clash/master/Rule/YouTube.yaml
    path: ./ruleset/Semporia/Clash/YouTube.yaml
    interval: 3600

proxy-groups:
  - name: 默认线路
    # <url-test | select | load-balance | random | fallback>
    type: select
    proxies:
      - 全球负载
      - 手动选择
      - 香港集群
      - 台湾集群
      - 新加坡集群
      - 日本集群
      - 韩国集群
      - 美国集群
      - 其他集群

  - name: 全球负载
    type: load-balance
    url: "http://www.gstatic.com/generate_204"
    interval: 60
    # strategy: <consistent-hashing | round-robin>
    strategy: consistent-hashing
    proxies:
      - 香港集群
      - 台湾集群
      - 新加坡集群
      - 日本集群
      - 韩国集群
      - 美国集群
      - 其他集群

  - name: 手动选择
    type: select
    use:
      - 香港机房
      - 台湾机房
      - 新加坡机房
      - 美国机房
      - 日本机房
      - 韩国机房
      - 其他机房

  # ============================================================================
  - name: 香港集群
    type: load-balance
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    strategy: consistent-hashing
    use:
      - 香港机房
  - name: 台湾集群
    type: load-balance
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    strategy: consistent-hashing
    use:
      - 台湾机房
  - name: 新加坡集群
    type: load-balance
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    strategy: consistent-hashing
    use:
      - 新加坡机房
  - name: 日本集群
    type: load-balance
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    strategy: consistent-hashing
    use:
      - 日本机房
  - name: 韩国集群
    type: load-balance
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    strategy: consistent-hashing
    use:
      - 韩国机房
  - name: 美国集群
    type: load-balance
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    strategy: consistent-hashing
    use:
      - 美国机房
  - name: 其他集群
    type: load-balance
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    strategy: consistent-hashing
    use:
      - 其他机房

rules:
  # ============================================================================
  # 私人定制
  # ----------------------------------------------------------------------------
  - DOMAIN-SUFFIX,chenzhenyuan.com,DIRECT,no-resolve
  - DOMAIN,raw.gitmirror.com,DIRECT
  - DOMAIN,raw.iqiq.io,DIRECT
  - DOMAIN,cdn.jsdelivr.net,DIRECT

  - DOMAIN-SUFFIX,sketch.cloud,DIRECT
  - DOMAIN,flow.logitech.io,DIRECT,no-resolve
  # - DOMAIN-KEYWORD,logitech,DIRECT,no-resolve

  - DOMAIN-SUFFIX,mac-torrent-download.net,默认线路
  # ============================================================================
  # IP测试 相关的规则
  # ----------------------------------------------------------------------------
  - DOMAIN,ip.900cha.com,DIRECT,no-resolve
  - DOMAIN,ip111.cn,DIRECT,no-resolve
  - DOMAIN-SUFFIX,ip.sb,DIRECT,no-resolve

  # ============================================================================
  # 常见广告域名屏蔽
  # ----------------------------------------------------------------------------
  - DOMAIN,injections.adguard.org,REJECT
  - DOMAIN,local.adguard.org,REJECT
  - DOMAIN-SUFFIX,appsflyer.com,REJECT
  - DOMAIN-SUFFIX,doubleclick.net,REJECT
  - DOMAIN-SUFFIX,mmstat.com,REJECT
  - DOMAIN-SUFFIX,vungle.com,REJECT
  - DOMAIN-KEYWORD,admarvel,REJECT
  - DOMAIN-KEYWORD,admaster,REJECT
  - DOMAIN-KEYWORD,adsage,REJECT
  - DOMAIN-KEYWORD,adsmogo,REJECT
  - DOMAIN-KEYWORD,adsrvmedia,REJECT
  - DOMAIN-KEYWORD,adwords,REJECT
  - DOMAIN-KEYWORD,adservice,REJECT
  - DOMAIN-KEYWORD,domob,REJECT
  - DOMAIN-KEYWORD,duomeng,REJECT
  - DOMAIN-KEYWORD,dwtrack,REJECT
  - DOMAIN-KEYWORD,guanggao,REJECT
  - DOMAIN-KEYWORD,lianmeng,REJECT
  - DOMAIN-KEYWORD,mopub,REJECT
  - DOMAIN-KEYWORD,omgmta,REJECT
  - DOMAIN-KEYWORD,openx,REJECT
  - DOMAIN-KEYWORD,partnerad,REJECT
  - DOMAIN-KEYWORD,pingfore,REJECT
  - DOMAIN-KEYWORD,supersonicads,REJECT
  - DOMAIN-KEYWORD,uedas,REJECT
  - DOMAIN-KEYWORD,umeng,REJECT
  - DOMAIN-KEYWORD,usage,REJECT
  - DOMAIN-KEYWORD,wlmonitor,REJECT
  - DOMAIN-KEYWORD,zjtoolbar,REJECT
  - RULE-SET,AdBlock,REJECT

  # ============================================================================
  # 规则集
  # ----------------------------------------------------------------------------
  - RULE-SET,LocalAreaNetwork,DIRECT

  - DOMAIN,api.github.com,DIRECT,no-resolve
  - RULE-SET,GitHub,香港集群

  - RULE-SET,Google,美国集群
  - RULE-SET,YouTube,美国集群
  - RULE-SET,Telegram,默认线路
  - RULE-SET,OverseasIP,默认线路,no-resolve

  - RULE-SET,Apple,DIRECT
  - RULE-SET,Tencent,DIRECT

  - PROCESS-NAME,aCity,默认线路,no-resolve
  # ============================================================================
  # Twitter
  # ----------------------------------------------------------------------------
  - RULE-SET,Twitter,香港集群
  - PROCESS-NAME,Twitter,香港集群

  # ============================================================================
  # 直连规则
  # ----------------------------------------------------------------------------
  - DOMAIN,api.faviconkit.com,DIRECT,no-resolve
  - DOMAIN,s.deepl.com,DIRECT,no-resolve
  - DOMAIN-SUFFIX,appcenter.ms,DIRECT,no-resolve
  - DOMAIN-SUFFIX,cn,DIRECT
  - DOMAIN-KEYWORD,-cn,DIRECT
  - RULE-SET,ChinaDomain,DIRECT
  - RULE-SET,Applications,DIRECT

  # ============================================================================
  # 白名单模式
  # ----------------------------------------------------------------------------
  - GEOIP,CN,DIRECT
  - MATCH,默认线路
